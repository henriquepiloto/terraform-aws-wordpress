# **Documenta칞칚o da Infraestrutura AWS para WordPress**

## **1. Arquitetura da Infraestrutura**
A infraestrutura foi projetada para hospedar o WordPress de maneira **segura, escal치vel e otimizada** na AWS, utilizando os seguintes servi칞os:

### **Diagrama da Arquitetura**
- ECS Fargate executando o cont칡iner do WordPress.
- Application Load Balancer (ALB) distribuindo o tr치fego.
- Amazon RDS MySQL como banco de dados gerenciado.
- AWS Auto Scaling para ECS e RDS.
- Amazon CloudFront para otimiza칞칚o de conte칰do.
- AWS WAF para prote칞칚o contra ataques.
- CloudWatch para logs e monitoramento.

## **2. Vari치veis do Terraform Utilizadas**
A infraestrutura foi modularizada, e cada m칩dulo aceita **vari치veis configur치veis**, permitindo reutiliza칞칚o de recursos existentes ou cria칞칚o de novos.

### **Exemplo de Configura칞칚o das Vari치veis**
```hcl
project_name = "wordpress"
aws_region = "us-east-1"

# Networking
vpc_id = "vpc-123456"
public_subnets = ["subnet-abc", "subnet-def"]
private_subnets = ["subnet-xyz", "subnet-lmn"]

# ECS
ecs_cluster_id = ""
task_definition_arn = ""
ecs_service_name = ""

db_host = ""
db_user = "admin"
db_password = "securepassword"
db_name = "wordpress_db"

ecs_cpu_threshold = 80
ecs_memory_threshold = 80
```

## **3. Como Rodar o Terraform**
A infraestrutura pode ser gerenciada pelo Terraform com os seguintes comandos:

### **Passo 1: Inicializar o Terraform**
```sh
terraform init
```

### **Passo 2: Validar a Configura칞칚o**
```sh
terraform validate
```

### **Passo 3: Planejar as Mudan칞as**
```sh
terraform plan
```

### **Passo 4: Aplicar as Mudan칞as**
```sh
terraform apply -auto-approve
```

### **Passo 5: Destruir a Infraestrutura (se necess치rio)**
```sh
terraform destroy -auto-approve
```

## **4. Guia de Troubleshooting**

### **Erro: 'Unsupported argument' em um m칩dulo**
- Verifique se as vari치veis est칚o corretamente definidas no `variables.tf` do m칩dulo.
- Confirme se o `source` do m칩dulo est치 correto no `main.tf`.
- Execute `terraform validate` para identificar problemas de sintaxe.

### **Erro: Falha na Conex칚o com o RDS**
- Verifique o **Security Group** do RDS e permita acesso do ECS.
- Obtenha o endpoint do banco:
  ```sh
  terraform output rds_endpoint
  ```
- Teste a conex칚o manualmente:
  ```sh
  mysql -h <rds-endpoint> -u admin -p
  ```

### **WordPress n칚o carrega via CloudFront**
- Obtenha o DNS do CloudFront:
  ```sh
  terraform output cloudfront_domain_name
  ```
- Teste diretamente no navegador e verifique se h치 erros de configura칞칚o.
- Confirme se a pol칤tica do **Origin SSL** est치 configurada corretamente no CloudFront.

## **5. Procedimento de Rollback e Recovery**
### **Rollback para uma Vers칚o Anterior do Terraform**
Caso uma vers칚o anterior da infraestrutura precise ser restaurada:
```sh
git checkout <commit-id>
terraform apply -auto-approve
```

### **Recupera칞칚o do Banco de Dados RDS**
1. **Restaurar um snapshot do RDS**:
   - Acesse o **Amazon RDS** > Snapshots > Escolha o snapshot > "Restore".
2. **Atualizar as vari치veis do Terraform** com o novo endpoint do banco.
3. **Reaplicar o Terraform**:
   ```sh
   terraform apply -auto-approve
   ```

### **Recupera칞칚o do ECS Fargate**
Caso o ECS pare de responder:
```sh
aws ecs update-service --cluster wordpress-ecs-cluster --service wordpress-service --desired-count 0
aws ecs update-service --cluster wordpress-ecs-cluster --service wordpress-service --desired-count 2
```

---

Essa documenta칞칚o deve ser mantida e atualizada conforme novas implementa칞칫es forem realizadas na infraestrutura. 游

